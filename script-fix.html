<script>
(function(){
    "use strict";

    /* LOADER */
    window.addEventListener("load", function() {
        var loader = document.getElementById("loaderScreen");
        if (loader) {
            setTimeout(function() {
                loader.classList.add("hidden");
            }, 800);
        }
    });

    /* CURSOR GLOW */
    var cg = document.getElementById("cursorGlow");
    if (cg) {
        document.addEventListener("mousemove", function(e) {
            cg.style.left = e.clientX + "px";
            cg.style.top = e.clientY + "px";
        });
    }

    /* MATRIX CANVAS */
    var mc = document.getElementById("matrixCanvas");
    if (mc) {
        var ctx = mc.getContext("2d");
        mc.width = window.innerWidth;
        mc.height = window.innerHeight;
        var cols = Math.floor(mc.width / 20);
        var drops = [];
        for (var x = 0; x < cols; x++) drops[x] = Math.random() * mc.height;
        var chars = "01„Ç¢„Ç§„Ç¶„Ç®„Ç™„Ç´„Ç≠„ÇØ„Ç±„Ç≥{}[]<>/\\|";
        function drawMatrix() {
            ctx.fillStyle = "rgba(10,10,10,0.05)";
            ctx.fillRect(0, 0, mc.width, mc.height);
            ctx.fillStyle = "#00d4ff";
            ctx.font = "14px monospace";
            for (var i = 0; i < drops.length; i++) {
                var t = chars[Math.floor(Math.random() * chars.length)];
                ctx.fillText(t, i * 20, drops[i]);
                if (drops[i] > mc.height && Math.random() > 0.975) drops[i] = 0;
                drops[i] += 20;
            }
        }
        setInterval(drawMatrix, 80);
        window.addEventListener("resize", function() {
            mc.width = window.innerWidth;
            mc.height = window.innerHeight;
        });
    }

    /* PARTICLES */
    var pc = document.getElementById("particles");
    if (pc) {
        var colors = ["rgba(0,212,255,0.4)", "rgba(123,47,247,0.4)", "rgba(255,45,149,0.3)"];
        for (var i = 0; i < 50; i++) {
            var p = document.createElement("div");
            p.className = "particle";
            var s = (Math.random() * 4 + 2) + "px";
            p.style.left = Math.random() * 100 + "%";
            p.style.width = s;
            p.style.height = s;
            p.style.animationDuration = (Math.random() * 15 + 10) + "s";
            p.style.animationDelay = (Math.random() * 10) + "s";
            p.style.opacity = String(Math.random() * 0.5 + 0.1);
            p.style.background = colors[Math.floor(Math.random() * colors.length)];
            pc.appendChild(p);
        }
    }

    /* TYPING */
    var phrases = ["Cyber Security Specialist üõ°Ô∏è", "Back-End Developer üíª", "Penetration Tester üîì", "Bug Bounty Hunter üéØ", "DevOps Engineer ‚ö°", "Exploit Developer üß©"];
    var pi = 0, ci = 0, del = false;
    var to = document.getElementById("typed-output");
    function typ() {
        var cp = phrases[pi];
        var sp;
        if (del) { ci--; to.textContent = cp.substring(0, ci); sp = 40; }
        else { ci++; to.textContent = cp.substring(0, ci); sp = 100; }
        if (!del && ci === cp.length) { sp = 2000; del = true; }
        else if (del && ci === 0) { del = false; pi = (pi + 1) % phrases.length; sp = 400; }
        setTimeout(typ, sp);
    }
    if (to) typ();

    /* NAVBAR SCROLL */
    var nb = document.getElementById("navbar");
    var stb = document.getElementById("scrollTop");
    window.addEventListener("scroll", function() {
        if (window.scrollY > 50) nb.classList.add("scrolled");
        else nb.classList.remove("scrolled");
        if (window.scrollY > 400) stb.classList.add("visible");
        else stb.classList.remove("visible");
    }, { passive: true });

    /* HAMBURGER */
    var hb = document.getElementById("hamburger");
    var nl = document.getElementById("navLinks");
    hb.addEventListener("click", function() {
        hb.classList.toggle("active");
        nl.classList.toggle("active");
    });
    document.querySelectorAll(".nav-links a").forEach(function(a) {
        a.addEventListener("click", function() {
            hb.classList.remove("active");
            nl.classList.remove("active");
        });
    });
    document.addEventListener("click", function(e) {
        if (!nb.contains(e.target) && nl.classList.contains("active")) {
            hb.classList.remove("active");
            nl.classList.remove("active");
        }
    });

    /* SCROLL TO TOP */
    stb.addEventListener("click", function() {
        window.scrollTo({ top: 0, behavior: "smooth" });
    });

    /* SCROLL ANIMATIONS */
    var obs = new IntersectionObserver(function(entries) {
        entries.forEach(function(entry) {
            if (entry.isIntersecting) {
                entry.target.classList.add("animated");
                obs.unobserve(entry.target);
            }
        });
    }, { threshold: 0.1, rootMargin: "0px 0px -30px 0px" });
    document.querySelectorAll(".animate-on-scroll").forEach(function(el) { obs.observe(el); });

    /* COUNTER */
    var counted = false;
    var cobs = new IntersectionObserver(function(entries) {
        if (entries[0].isIntersecting && !counted) {
            counted = true;
            document.querySelectorAll(".stat-number").forEach(function(c) {
                var target = parseInt(c.getAttribute("data-count"), 10);
                var current = 0;
                var inc = Math.max(target / 60, 1);
                function upd() {
                    current += inc;
                    if (current < target) { c.textContent = Math.ceil(current) + "+"; requestAnimationFrame(upd); }
                    else { c.textContent = target + "+"; }
                }
                upd();
            });
            cobs.unobserve(entries[0].target);
        }
    }, { threshold: 0.3 });
    var abt = document.getElementById("about");
    if (abt) cobs.observe(abt);

    /* ACTIVE NAV */
    var secs = document.querySelectorAll("section");
    var nls = document.querySelectorAll(".nav-links a");
    window.addEventListener("scroll", function() {
        var cur = "";
        secs.forEach(function(s) { if (window.scrollY >= s.offsetTop - 200) cur = s.getAttribute("id"); });
        nls.forEach(function(a) {
            a.classList.remove("active");
            if (a.getAttribute("href") === "#" + cur) a.classList.add("active");
        });
    }, { passive: true });

    /* TILT EFFECT */
    document.querySelectorAll(".service-card, .project-card").forEach(function(card) {
        card.addEventListener("mousemove", function(e) {
            var r = card.getBoundingClientRect();
            var rx = (e.clientY - r.top - r.height / 2) / 20;
            var ry = (r.width / 2 - (e.clientX - r.left)) / 20;
            card.style.transform = "translateY(-10px) perspective(1000px) rotateX(" + rx + "deg) rotateY(" + ry + "deg)";
        });
        card.addEventListener("mouseleave", function() {
            card.style.transform = "translateY(0) perspective(1000px) rotateX(0) rotateY(0)";
        });
    });

    /* FORM */
    var cf = document.getElementById("contactForm");
    var sb = document.getElementById("submitBtn");
    if (cf) {
        cf.addEventListener("submit", function(e) {
            e.preventDefault();
            sb.innerHTML = '<i class="fas fa-check"></i> G√∂nd…ôrildi!';
            sb.style.background = "linear-gradient(135deg,#00c851,#007e33)";
            setTimeout(function() {
                sb.innerHTML = '<i class="fas fa-paper-plane"></i> Mesaj G√∂nd…ôr';
                sb.style.background = "linear-gradient(135deg,#00d4ff,#7b2ff7)";
                cf.reset();
            }, 3000);
        });
    }

    /* SMOOTH SCROLL */
    document.querySelectorAll('a[href^="#"]').forEach(function(a) {
        a.addEventListener("click", function(e) {
            e.preventDefault();
            var t = document.querySelector(this.getAttribute("href"));
            if (t) t.scrollIntoView({ behavior: "smooth", block: "start" });
        });
    });

})();
</script>
